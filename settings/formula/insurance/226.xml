<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE Formula-definition SYSTEM "Formula-definition.dtd">
<!-- 商品毎に計算公式はここに定義する -->
<Formula-definition>
	<BizExpenses desc="予定事業費率等">
		<formula name="HM_gamma" value="0.0002" />
		
		<formula name="beta" value="0.150" />
		
		<formula name="zeta" value="0.025" />
		
		<formula name="epsilon" value="0.003" />
	</BizExpenses>
	
	<Common desc="商品内部の共通公式">
		<formula name="HM_A_x_n" paras="x,n" fraction="6" desc="給付現価">
			(HM_MT[x]-HM_MT[x+n])/DT[x]
		</formula>
		
		<formula name="PrateByPaymode" paras="stdPrate" fraction="5" desc="払込方法別Prate">
			<!-- 基準Prate、払込方法別Prateを求める -->
			stdPrate*PayFactor(kaisu,gen,keiro)
		</formula>
		
		<formula name="S2P" paras="SBasePrate" desc="S基準からP基準に変換する">
			<!-- 普通の場合 -->
			if(kaisu==1){
				round(1/SBasePrate,4)
			}else{
				round(1/SBasePrate,2)
			}
		</formula>
	</Common>
	
	<!-- 保険料　ここから -->
	<Premium desc="保険料">
		<formula name="stdPrate" pvh="P" fraction="5" desc="基準Prate">
			(HM_A_x_n(x,n)+HM_gamma*aT_x_n(x,n))/{12*(1-beta-zeta-epsilon)*aT12_x_n(x,n)}
		</formula>
		
		<formula name="Prate" pvh="P" accessable="true" fraction="5" desc="１.保険料レート">
			PrateByPaymode(stdPrate)
		</formula>
		
		<formula name="Premium" pvh="P" accessable="true" desc="２.保険料/保険金額">
			<!-- 高額割引がゼロ 100円の位を切り上げ-->
			if(sptate==0){
				<!-- Ｐレートはゼロより小さい場合、ゼロとする -->
				roundDown(SA*max{PrateByPaymode(stdPrate),0},0)
			}else{
				roundUp(roundDown(SA*S2P(PrateByPaymode(stdPrate)),0)/1000,0)*1000
			}
		</formula>
	</Premium>
	<!-- 責任準備金　ここから -->
	<ReserveFund desc="責任準備金">	
		<formula name="yearPrate" pvh="P" fraction="5" desc="年払Prate">
			PayFactor(2,gen,1)*stdPrate
		</formula>
		
		<formula name="Vrate_accu" paras="t">
			<!-- 保険料払込期間中 -->
			if(state==1){
				max(HM_A_x_n(x+t,n-t)-((HM_A_x_n(x,n))/aT_x_n(x,n)*aT_x_n(x+t,n-t)),0)
			}elseIf(state==6){
				<!-- 保険料払込免除 -->
				HM_A_x_n(x+t,n-t)+HM_gamma*aT_x_n(x+t,n-t)
			}else{
				0
			}
		</formula>
		<formula name="Vrate" accessable="true" pvh="H" fraction="4" desc="１．保険年度末Vレート">
			Vrate_accu(t)
		</formula>
		
		<formula name="Exemption" paras="t" xtime="1" desc="事業末保険料免除">
			<!-- 事業末の免除状態の予定解約率は（保険料払込期間終了後）を使用する。 -->
			HM_A_x_n(x+t,n-t)+HM_gamma*aT_x_n(x+t,n-t)
		</formula>
		
		<formula name="BizYearV" paras="t" fraction="4" desc="事業末Vレート">
			<!-- 保険料払込期間中 -->
			if(state==1){
				if(round(HM_A_x_n(x,n)/aT_x_n(x,n),5)&gt;yearPrate){
					max(HM_A_x_n(x+t,n-t)-yearPrate*aT_x_n(x+t,n-t),0)
				}else{
					max(HM_A_x_n(x+t,n-t)-(HM_A_x_n(x,n)/aT_x_n(x,n))*aT_x_n(x+t,n-t),0)
				}
			}elseIf(state==6){
				Exemption(t)
			}else{
				0
			}
		</formula>
				
		<formula name="BizYearVate" pvh="if(kisoritsu==0){P}elseIf(kisoritsu==1){V}else{H}" accessable="true" desc="２．事業年度末Vレート">
			BizYearV(t)
		</formula>
		
		<formula name="ContractorYearV" pvh="P" fraction="4" paras="t" desc="保険年度契約者VTレート">
			if(state==1||state==6){
				max(HM_A_x_n(x+t,n-t)-((HM_A_x_n(x,n))/aT_x_n(x,n)*aT_x_n(x+t,n-t)),0)
			}else{
				0		
			}
		</formula>
		<formula name="ContractorVrate" accessable="true" pvh="P" fraction="4" desc="３．契約者用Vレート">
			(1-f_12(f1))*ContractorYearV(t1)+(f_12(f1))*ContractorYearV(t1+1)
		</formula>	
	</ReserveFund>
	
	<!-- 解約返戻金　ここから -->
	<SurrenderFee desc="解約返戻金">
		<formula name="tWrate" paras="t">
			0
		</formula>
		
		<formula name="Wrate" pvh="P" accessable="true" desc="１.解約返戻金Ｗレート">
			0
		</formula>
	</SurrenderFee>
</Formula-definition>