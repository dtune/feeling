<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE Formula-definition SYSTEM "Formula-definition.dtd">
<!-- 商品毎に計算公式はここに定義する -->
<Formula-definition>
	<BizExpenses desc="事業費率の設定">
	
		<formula name="alpha" paras="n" fraction="8" desc="新契約費a">
			0.006*min(n/10,1)
		</formula>
		
		<formula name="delta" paras="n" fraction="3" desc="新契約費δ">
			if(kaisu==1){
				max{0.04-0.01/5*max(x+n-55,0),0}
			}else{
				max{0.06-0.01/5*max(x+n-55,0),0}
			}
		</formula>
		
		<formula name="epsilon" paras="m" desc="保険料払込免除">
			if(m&lt;=5){
				0.0005
			}elseIf(m&gt;5 &amp;&amp; m&lt;=10){
				0.0010
			}else{
				0.0020
			}
		</formula>
		
		<formula name="qDD" paras="x,ptn" desc="予定死亡率・予定発生率"> 	
			if(contractUpdType==1 || ptn==1){
			<!-- 更新契約 -->
				qxDD1[x]
			}else{
				1/4*(3*qxDD1[x]+qxDD2[x])
			}
		</formula>	
	
		<!-- 固定値であれば、下記のように属性valueのところを書いてください -->
		
		<formula name="gamma" value="0.00126"/>
		<formula name="gamma1" value="0.001"/>
		<formula name="beta" value="0.03"/>
		<formula name="zeta" value="0.025"/>
	</BizExpenses>
	
	<Common desc="商品内部の共通公式">
		
		<!-- 310専用生命年金現価　ここから -->
		<formula name="S_a_DD" paras="x,m,ptn" fraction="5">
			1+v*(1-qDD(x,ptn))*a_x_n(x+1,m-1)
		</formula>
		
		<formula name="S_a_DD12" paras="x,m,ptn" fraction="5">
			13/24+v*(1-qDD(x,ptn))*(11/24+a_k_x_n(12,x+1,m-1))
		</formula>
		
		<formula name="S_ma_DD" paras="m,x,n,ptn" fraction="5">
			<!-- v*(1-qDD(x,ptn))*a_x_n(x+1,n-m) -->
			v*(1-qDD(x,ptn))*f_a_x_n(m-1,x+1,n-1)
		</formula>
		
		<formula name="a_DD" paras="x,m" fraction="5">
			a_x_n(x,m)
		</formula>
		
		<formula name="a_DD12" paras="x,m" fraction="5">
			a_k_x_n(12,x,m)
		</formula>
		
		<formula name="ma_DD" paras="m,x,n" fraction="5">
			f_a_x_n(m,x,n)
		</formula>
		
		<!-- 給付現価　ここから -->
		<formula name="A1_DD" paras="x,n" fraction="6">
			1/D[x]*sum(0,n-1){C[x+index]}
		</formula>
		
		<formula name="SA1_DD" paras="x,n,ptn" fraction="6">
			v^(1/2)*qDD(x,ptn)+v*(1-qDD(x,ptn))*A1_DD(x+1,n-1)
		</formula>
		
		<!-- 下記の分割払いの係数定義は商品に問わずため、外部の共通commonフォルダに移す -->
		
		
		<formula name="PrateByPaymode" paras="stdPrate,d" fraction="6" desc="払込方法別Prate">
			<!-- 基準Prateと高額割引dより、払込方法別Prateを求める -->
			<formula name="Discount" paras="d" desc="高額割引">
				if(kaisu==1){0}
				elseIf(kaisu==2){12*d}
				elseIf(kaisu==3){6*d}
				else{d}
			</formula>
			stdPrate*PayFactor(kaisu,gen,keiro)-Discount(d)
		</formula>
		
		<formula name="S2P" paras="SBasePrate" desc="S基準からP基準に変換する">
				<!-- 普通の場合 -->
				if(kaisu==1){
					round(1/SBasePrate,4)
				}else{
					round(1/SBasePrate,2)
				}
		</formula>
	</Common>
	
	<Premium desc="保険料">
		<formula name="stdPrate" pvh="P" desc="基準Ｐレート">
			if(kaisu==1){singlePrate}else{MultiPrate(1)}
			<formula name="singlePrate" fraction="5" desc="一時払いPレート">
				{SA1_DD(x,n,0)+alpha(n)+gamma1*S_a_DD(x,n,0)}/(1-delta(n))
			</formula>
			<formula name="MultiPrate" paras="ptn" fraction="6" desc="分割払いPレート">
				if(m==n){
					if((x+n)&lt;90){
							set{t_Prate=MultiPrateCompare(n,ptn)}
							set{i=n}
						while(i&lt;90-x){
							t_Prate=min(t_Prate,MultiPrateCompare(i,ptn))
							set(i=i+1)
						}
					}else{
						MultiPrateCompare(n,ptn)
					}
				}elseIf(m&lt;n){
					MultiPrate2(ptn)
				}else{0}
				<formula name="MultiPrateCompare" paras="n,ptn">
					{SA1_DD(x,n,ptn)+alpha(n)+gamma*S_a_DD12(x,n,ptn)}/warusu(n,n,ptn)
				</formula>
				<formula name="MultiPrate2" paras="ptn">
					{SA1_DD(x,n,ptn)+alpha(n)+gamma*S_a_DD12(x,m,ptn)+gamma1*S_ma_DD(m,x,n,ptn)}/warusu(n,m,ptn)
				</formula>
				<formula name="warusu" paras="n,m,ptn">
					12*(1-beta-zeta-delta(n)-epsilon(m))*S_a_DD12(x,m,ptn)
				</formula>
			</formula>
		</formula>
		<formula name="Prate" pvh="P" accessable="true" desc="１．保険料レート">
			PrateByPaymode(stdPrate,0)
		</formula>
		<formula name="adjustStdPrate" pvh="P" desc="調整基準Ｐレート">
			if(kaisu==1){
				0
			}else{
			<!-- 更新契約のPrate - 新契約のPrate -->
				PrateByPaymode(MultiPrate(1),0)-PrateByPaymode(MultiPrate(0),0)
			}
		</formula>
		
		<formula name="adjustPrate" pvh="P" desc="調整P実額">
			if(contractUpdType==1){
				<!-- 更新契約 -->
				0
			}else{
				<!-- 新契約 -->
				round(SA*adjustStdPrate,0)
			}
		</formula>
		
		<!-- OL用計算公式 -->
		<formula name="Premium" pvh="P" paras="stdPrate" accessable="true"
			desc="２．保険料・保険金">
			if(sptate==0){
				roundDown(SA*max{PrateByPaymode(stdPrate,0),0},0)
			}else{
				roundUp(
					roundDown(
						SA*S2P(PrateByPaymode(stdPrate,0))
					,0)/1000
				,0)*1000
			}
		</formula>
	</Premium>
	
	<ReserveFund desc="責任準備金">
	
		<!-- a.保険年度末保険料積立金rate -->
		<formula name="A_Z" desc="チルメル式αz">
			0.008*min(n/10,1)
		</formula>
		
		<formula name="MultiV" paras="t,z" desc="保険料払込期間中/保険料払込免除契約のVTレート">
			<!-- 保険料払込期間中（保険料払込免除を含む） -->
			if(t==0){
				0
			}else{
				max{A1_DD(x+t,n-t)+gamma1*a_x_n(x+t,n-t)-(SA1_DD(x,n,0)+gamma1*S_a_DD(x,n,0))/S_a_DD(x,m,0)*a_x_n(x+t,m-t)
					-
				if(z==0){0}else{A_Z/S_a_DD(x,z,0)*a_x_n(x+t,z-t)}	
				,0}
			}
		</formula>
		
		<formula name="Vrate_accu" paras="t,z" desc="保険年度末Vrate">
			if(state==1||state==6){
			<!-- 保険料払込期間中（保険料払込免除を含む） -->
				MultiV(t,z)			
			}elseIf(kaisu==1||state==2){
			<!-- 一時払.保険料払込期間終了後 -->
				if(t==0){
					SA1_DD(x+t,n-t,0)+gamma1*S_a_DD(x+t,n-t,0)
				}else{
					A_xt_nt_D(x,t,n)+gamma1*a_x_n(x+t,n-t)
				}
			}else{0}
		</formula>
		
		<formula name="Vrate" pvh="H" fraction="4" accessable="true" desc="１．保険年度末Vレート">
			Vrate_accu(t,0)
		</formula>

		<formula name="ContractorYearV" pvh="P" paras="t,z" fraction="4" desc="契約者用Vレート">
			Vrate_accu(t,z)
		</formula>
		
		<formula name="ContractorVrate" pvh="P" fraction="4" accessable="true" desc="３．契約者用Vレート">
			if(state==1||state==6){
				(1-f_12(f1))*ContractorYearV(t1,z)+f_12(f1)*ContractorYearV(t1+1,z)
			}elseIf(kaisu==1||state==2){
				(1-f_12(f))*ContractorYearV(t,z)+f_12(f)*ContractorYearV(t+1,z)
			}else{
				0
			}
		</formula>
		
		<formula name="yearPrate" pvh="P" fraction="6" desc="年払いPrate（P基礎）">
			PayFactor(2,gen,1)*stdPrate
		</formula>
		
		<formula name="BizYearV" paras="t,z" accessable="false" desc="事業末Vレート">		
			<!-- 保険料払込期間中 -->
			max(
			if(state==1){
				if(round((SA1_DD(x,n,0)+gamma1*S_ma_DD(m,x,n,0))/S_a_DD(x,m,0),6)&lt;=yearPrate){					
					MultiV(t,z)				
				}else{				
					A1_DD(x+t,n-t)+gamma1*a_DD(x+t,n-t)-(yearPrate+gamma1)*a_DD(x+t,m-t)
					-
					if(z==0){0}else{A_Z/S_a_DD(x,z,0)*a_DD(x+t,z-t)}				
				}
			}elseIf(kaisu==1||state==2||state==6){			
			<!-- 一時払.保険料払込期間終了後.保険料払込免除後 -->			
				if(t==0){
					SA1_DD(x+t,n-t,0)+gamma1*S_a_DD(x-t,n-t,0)
				}else{
					A1_DD(x+t,n-t)+gamma1*a_DD(x+t,n-t)
				}
			}else{0}
			,0)
		</formula>
		<formula name="calBizYearV" fraction="4" desc="事業末用Vレート">
			BizYearV(t,z)
		</formula>
		
	</ReserveFund>
	
	<SurrenderFee desc="解約返戻金">
		
		<formula name="tSigma" paras="t" desc="σ">
			if(gen==4){
				0.006*min(n/10,1)*max{1-t/min(m,10),0}
			}else{0}
		</formula>
		
		<formula name="tWrate" paras="t" pvh="P" fraction="4" desc="解約返戻金Wレート">
			if(state==1){
				<!-- 保険料払込期間中（保険料払込免除を含む） -->
				max(ContractorYearV(t,0)-tSigma(t),0)
			}elseIf(kaisu==1||state==2){
				<!-- 一時払.保険料払込期間終了後 -->
				ContractorYearV(t,0)
			}else{0}		
		</formula>
		
		<formula name="Wrate" pvh="P" fraction="4" accessable="true" desc="１．解約返戻金Wレート">
			if(PremiumAbolishSign==1){
				if(state==1||state==6){
					if(12*t1+f1&lt;12*t+f){
						(1-f_12(f1))*tWrate(t1)+f_12(f1)*tWrate(t1+1)
					}else{
						(1-f_12(f))*tWrate(t)+f_12(f)*tWrate(t+1)
					}
				}elseIf(state==2||kaisu==1){
					(1-f_12(f))*tWrate(t)+f_12(f)*tWrate(t+1)
				}else{0}
			}else{
				if(state==1||state==6){
					v^ve*round((1-f_12(f1))*tWrate(t1)+f_12(f1)*tWrate(t1+1),4)
				}elseIf(state==2||kaisu==1){
					(1-f_12(f))*tWrate(t)+f_12(f)*tWrate(t+1)
				}else{0}
			}
		</formula>
	</SurrenderFee>
</Formula-definition>