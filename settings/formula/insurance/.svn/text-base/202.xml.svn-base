<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE Formula-definition SYSTEM "Formula-definition.dtd">
	<!-- 商品毎に計算公式はここに定義する -->
<Formula-definition>
	<BizExpenses desc="事業費率の設定">
		 <!-- 予定発生率等 -->
		 <formula name="rho_x" desc="予定災害入院率(本人部分)(rho_x)">
		 		if(gen==7){0.010645}else{0.0159}
		 </formula>
		 <formula name="rho_y" desc="予定災害入院率(配偶者部分)(rho_y)">
		        1/2*rho_x
		 </formula>
		 <formula name="rho_z" desc="予定災害入院率(子部分)(rho_z)">
		        if(gen==7){0.010645}else{0.0159}
		 </formula>
		  <formula name="rho" paras="r_type" desc="予定災害入院率">
		       if(r_type==1){rho_x}
		       elseIf(r_type==2){rho_y}
		       else{rho_z}
		  </formula>
		  
	    <formula name="T_i"  desc="予定災害入院給付日数">
	           if(i==120){if(gen==7){32}else{37.3}}
	           elseIf(i==360){if(gen==7){35.5}else{44.7}}
	           elseIf(i==730){if(gen==7){37}else{46.8}}
	           else{0}
	    </formula>
		 
		 <!-- 予定事業費率 -->
		 <formula name="e_i" desc="支払限度i日型の予定事業費率(e_i)">
		      if(i==120){0.167}
		      elseIf(i==360){0.200}
		      elseIf(i==730){0.210}
		      else{0}
		 </formula>
		 <formula name="zeta" desc="集金費(zeta)">
		       if(gen==1){0.04}
		       elseIf(gen==2){0.03}
		       else{0.025}
		 </formula>
		 <formula name="epsilon" desc="P免除(epsilon)">
		        if(m1==n1){0.002}
		        elseIf(m1&lt;=5){0.0005}
		        elseIf(m1&gt;10){0.002}
		        else{0.001}
		 </formula>
		 <formula name="n1">
		 	if(n==99){omega-x+1}else{n}
		 </formula>
		 <formula name="m1">
		 	if(m==99){omega-x+1}else{m}
		 </formula>
		
	</BizExpenses>
	<Common desc="商品内部の共通公式">
		 	<!-- 生命年金　共通定義 -->
	     <formula name="vq" paras="x">
    		1-v*(1-qx[40])
    	</formula>
    	<formula name="vqe" paras="x,n">
    		(v*(1-qx[40]))^n
    	</formula>
		<formula name="a_x_n" paras="x,n" fraction="5">
			if(n&lt;=0){0}else{(1-vqe(x,n))/vq(x)}
		</formula>
		<formula name="a_k_x_n" paras="k,x,m" fraction="5" desc="始期払k回年金現価">
			(1-vqe(x,m))/vq(x)-(k-1)/(2*k)*(1-vqe(x,m))
		</formula>
		<formula name="f_a_x_n" paras="m,x,n" fraction="5">
			vqe(x,m)*(1-vqe(x,n-m))/vq(x)
		</formula>
		 
		<formula name="PrateByPaymode" paras="stdPrate,d" fraction="3"
			desc="払込方法別Prate">
			<!-- 基準Prateと高額割引dより、払込方法別Prateを求める -->
			<formula name="Discount" paras="d" desc="高額割引">
				if(kaisu==1){0}
				elseIf(kaisu==2){12*d}
				elseIf(kaisu==3){6*d}
				else{d}
			</formula>
			stdPrate*PayFactor(kaisu,gen,keiro)-Discount(d)
		</formula>

		<formula name="S2P" paras="SBasePrate" desc="S基準からP基準に変換する">
			<!-- 普通の場合 -->
			if(kaisu==1){round(1/SBasePrate,2)}
			else{round(1/SBasePrate,2)}
		</formula>
	</Common>
	<Premium desc="保険料">
	<!--共通子定義   -->
	<formula name="Prate_LumpPay_sub"  paras="r_type" desc="一時払(sub)">
	            (v^(1/2)*rho(r_type)*T_i+e_i)*a_x_n(x,n1)
	</formula>
	<formula name="Prate_InstallPay_sub"  paras="n,m,r_type" desc="分割払(sub)">
        (v^(1/2)*rho(r_type)*T_i*a_x_n(x,n)+e_i*a_k_x_n(12,x,m)+e_i*f_a_x_n(m,x,n))
        /(12*(1-zeta-epsilon)*a_k_x_n(12,x,m))
	</formula>
	<formula name="Prate_LumpPay_Principal" desc="一時払本人部分基準レート" fraction="3">
	         Prate_LumpPay_sub(1)
	</formula>
	<formula name="Prate_LumpPay_Spouse"  desc="一時払配偶者部分基準レート" fraction="3">
	        Sy/100*Prate_LumpPay_sub(2)
	</formula>
	<formula name="Prate_LumpPay_Child" desc="一時払子部分基準レート" fraction="3">
	       2*Sz/100*Prate_LumpPay_sub(3)
	</formula>
	<formula name="Prate_InstallPay_Principal" desc="分割払本人部分基準レート"  fraction="3">
	        <!-- 全期払の場合はｎ＝ｍ＝１-->
	        if(n1==m1){Prate_InstallPay_sub(1,1,1)}
	        else{Prate_InstallPay_sub(n1,m1,1)}
	</formula>
	<formula name="Prate_InstallPay_Spouse" desc="分割払配偶者部分基準レート"  fraction="3">
	          <!-- 全期払の場合はｎ＝ｍ＝１-->
	        if(n1==m1){Sy/100*Prate_InstallPay_sub(1,1,2)}
	        else{Sy/100*Prate_InstallPay_sub(n1,m1,2)}
	</formula>
	<formula name="Prate_InstallPay_Child" desc="分割払子部分基準レート"  fraction="3" >
	         <!-- 全期払の場合はｎ＝ｍ＝１-->
	        if(n1==m1){Sz/100*Prate_InstallPay_sub(1,1,3)*2}
	        else{Sz/100*Prate_InstallPay_sub(n1,m1,3)*2}
	</formula>
	<!-- 基準Ｐrate(型別) -->
		<formula name="Prate" pvh="P" accessable="true" desc="１．保険料レート">
			PrateByPaymode(stdPrate,0)
		</formula>
		<formula name="stdPrate" pvh="P" accessable="false" desc="基準保険料レート">
		      <!-- 本人型 -->
		      if(contractorType==1){
		           if(kaisu==1){Prate_LumpPay_Principal}
		           else{Prate_InstallPay_Principal}
		           <!-- 本人配偶者型 -->
		      }elseIf(contractorType==2){
		           if(kaisu==1){Prate_LumpPay_Principal+Prate_LumpPay_Spouse}
		           else{Prate_InstallPay_Principal+Prate_InstallPay_Spouse}
		      }
		       <!-- 本人配偶者子型 -->
		      elseIf(contractorType==3){
		          if(kaisu==1){Prate_LumpPay_Principal+Prate_LumpPay_Spouse+Prate_LumpPay_Child}
		          else{Prate_InstallPay_Principal+Prate_InstallPay_Spouse+Prate_InstallPay_Child}  
		      }
		       <!-- 本人子型 -->
		      elseIf(contractorType==4){
		          if(kaisu==1){Prate_LumpPay_Principal+Prate_LumpPay_Child}
		          else{Prate_InstallPay_Principal+Prate_InstallPay_Child}  
		      }
		      else{0}
		</formula>
        
        <formula name="Premium" pvh="P" accessable="true" desc="２．保険料・保険金">
			<!-- 高額割引がゼロ 100円の位を切り上げ--> 
			if(sptate==0){
         <!--Ｐレートはゼロより小さい場合、ゼロとする  -->
			   roundDown(SA*max{Prate,0},0)
			}else{
			   roundUp(roundDown(SA*S2P(Prate),0)/1000,0)*1000
		     }
	   </formula>
	</Premium>

	<ReserveFund desc="保険積立金">		 
		<formula name="Vrate_sub_term" paras="t,r_type">
		    Vrate_sub_piad(t,r_type)-(v^(1/2)*rho(r_type)*T_i+e_i)*a_x_n(x,n1)/a_x_n(x,m1)*a_x_n(x,m1-t)
		</formula>
		<formula name="Vrate_sub_piad" paras="t,r_type">
		    (v^(1/2)*rho(r_type)*T_i+e_i)*a_x_n(x,n1-t)
		</formula>

		 <formula name="V_self_term" paras="t" fraction="2" desc="本人部分レート.期間中">
		 	max(Vrate_sub_term(t,1),0)
		 </formula>
		 <formula name="V_self_paid" paras="t" fraction="2" desc="本人部分レート.終了後">
		 	Vrate_sub_piad(t,1)
		 </formula>

		 <formula name="V_mate_term" paras="t" fraction="2" desc="配偶者部分レート.期間中">
		 	max(Vrate_sub_term(t,2)*Sy/100,0)
		 </formula>
		 <formula name="V_mate_paid" paras="t" fraction="2" desc="配偶者部分レート.終了後">
		 	Sy/100*Vrate_sub_piad(t,2)
		 </formula>

		 <formula name="V_Child_term" paras="t" fraction="2" desc="子部分レート.期間中">
		 	max(Vrate_sub_term(t,3)*Sz*2/100,0)
		 </formula>
		 <formula name="V_Child_paid" paras="t" fraction="2" desc="子部分レート.終了後">
		 	Sz*2/100*Vrate_sub_piad(t,3)
		 </formula>
		 
		 <formula name="Vrate_term" paras="t" desc="保険料払込期間中">
		      <!-- 本人型 -->
			if(contractorType==1){
				V_self_term(t)
		      <!-- 本人 配偶者型-->
			}elseIf(contractorType==2){
				V_self_term(t)+V_mate_term(t)
		      <!-- 本人配偶者子型 -->
			}elseIf(contractorType==3){
		       	V_self_term(t)+V_mate_term(t)+V_Child_term(t)      
			  <!-- 本人子型 -->
			}elseIf(contractorType==4){
				V_self_term(t)+V_Child_term(t)
			}else{
				0
			}
		 </formula>
		 
		 <formula name="Vrate_paid" paras="t" desc="保険料払込期間終了後">
		      <!-- 本人型 -->
			if(contractorType==1){
				V_self_paid(t)
		      <!-- 本人配偶者型 -->
			}elseIf(contractorType==2){
				V_self_paid(t)+V_mate_paid(t)
		       <!-- 本人配偶者子型 -->
			}elseIf(contractorType==3){
		       	V_self_paid(t)+V_mate_paid(t)+V_Child_paid(t)      
			  <!-- 本人子型 -->
			}elseIf(contractorType==4){
				V_self_paid(t)+V_Child_paid(t)
			}else{
				0
			}
		 </formula>
		 
		 <formula name="Vrate_accu" paras="t" fraction="2" desc="保険年度末rate">
			if(state==1||state==6){
				Vrate_term(t)
			}elseIf(state==2||kaisu==1){
				Vrate_paid(t)
			}else{
				0
			}
		</formula>
		 <!-- 保険年度末Vレート  -->
		 <formula name="Vrate" pvh="if(gen&gt;2){H}else{V}" paras="t" fraction="2" accessable="true" desc="１．保険年度末Vレート">
			Vrate_accu(t)
		 </formula>

		 <!-- 契約者用Vレート -->
		<formula name="ContractorYearV" pvh="P" paras="t" fraction="2" desc="保険年度契約者VTレート">
			Vrate_accu(t)
		</formula>

		<formula name="ContractorVrate" pvh="P" fraction="2" accessable="true" desc="３．契約者用Vレート">
			if(state==1||state==6){
				(1-f_12(f1))*ContractorYearV(t1)+f_12(f1)*ContractorYearV(t1+1)
			}elseIf(state==2||kaisu==1){
				(1-f_12(f))*ContractorYearV(t)+f_12(f)*ContractorYearV(t+1)
			}else{
				0
			}
		</formula> 
		
		<!-- 事業年度末Vレート  -->
		<formula name="BizYearV" paras="t" fraction="2" accessable="false" desc="事業末Vレート">
			if(state==1){
				Vrate_term(t)
			}elseIf(state==2||state==6||kaisu==1){
				Vrate_paid(t)
			}else{
				0
			}
		</formula>
		
		<formula name="BizYearVate" pvh="if(kisoritsu==0){P}elseIf(kisoritsu==1){V}else{H}" accessable="true" desc="２．事業年度末Vレート">
			BizYearV(t)
		</formula>
		
	</ReserveFund>
	<SurrenderFee desc="解約返戻金">
		<formula name="tSigma" paras="t" desc="解約控除率">
				 if(t&lt;3){1-m1/n1}
				 else{1}
		</formula>
        <formula name="tWrate" paras="t" pvh="P" accessable="false" desc="解約返戻金Wレート">
			  <!-- 払込期間中　または　免除 -->					
			if(state==1 || state==6){max(ContractorYearV(t),0)}
			<!-- 払込終了後  一時払  -->
			  elseIf(state==2||kaisu==1){ContractorYearV(t)}
			  else{0}
		</formula>
		<formula name="Wrate" fraction="2" pvh="P" accessable="true" desc="１．解約返戻金Wレート">
			if(PremiumAbolishSign==1){
				if(state==1||state==6){
					if((12*t1+f1&lt;12*t+f)&lt;0){
						tSigma(t1)*round((1-f_12(f1))*tWrate(t1)+f_12(f1)*tWrate(t1+1),2)
					}else{
						tSigma(t)*round((1-f_12(f))*tWrate(t)+f_12(f)*tWrate(t+1),2)
					}+0.000000000001
				}elseIf(state==2||kaisu==1){
					(1-f_12(f))*tWrate(t)+f_12(f)*tWrate(t+1)
				}else{0}
			}else{
				if(state==1||state==6){
					v^ve*tSigma(t1)*round((1-f_12(f1))*tWrate(t1)+f_12(f1)*tWrate(t1+1),2)+0.000000000001
				}elseIf(state==2||kaisu==1){
					(1-f_12(f))*tWrate(t)+f_12(f)*tWrate(t+1)
				}else{0}
			}
		</formula>
	</SurrenderFee>
</Formula-definition>