<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Formula-definition SYSTEM "Formula-definition.dtd">
<!-- 商品毎に計算公式はここに定義する -->
<Formula-definition>
	<BizExpenses desc="事業費率の設定">
		<formula name="alpha" paras="n" desc="新契約費(alpha)">
			roundDown(0.006*min(n/10,1),8)
		</formula>
		<formula name="delta" paras="n" fraction="3" desc="新契約費(delta)">
			if(kaisu==1){max(0.04-0.01/5*max(x+n-55,0),0)}
			else{max(0.06-0.01/5*max(x+n-55,0),0)}
		</formula>
		<formula name="gamma" desc="維持費（保険料払込期間中）(gamma)">
			if(gen==1){0.00115}
			else{0.00105}		
		</formula>
		<formula name="gamma_nashu" value="0.001"
			desc="維持費（保険料払込期間終了後（一時払を含む））(gamma_nashu)" />
		<formula name="beta" value="0.03" desc="集金費(beta)" />
		<formula name="zeta" desc="集金費(zeta)">
			if(gen==1){0.04}elseIf(gen==2){0.03}else{0.025}
        </formula>
		<formula name="epsilon" paras="m" desc="Ｐ免費用(epsilon)">
			if(m&lt;=5){0.0005}
			elseIf(m&gt;5 &amp;&amp; m&lt;=10){0.001}
			else{0.002}
        </formula>
	</BizExpenses>
	<Common desc="商品内部の共通公式">
    	<formula name="az_formula" paras="t,z">
        	if(z==0){0}else{0.008*min(n/10,1)/a_x_n(x,z)*a_x_n(x+t,z-t)}
        </formula>
		<formula name="PrateByPaymode" paras="sPrate,d" fraction="6"
			desc="払込方法別Prate">
			<!-- 基準Prateと高額割引dより、払込方法別Prateを求める -->
			<formula name="Discount" paras="d" desc="高額割引">
				if(kaisu==1){0}
				elseIf(kaisu==2){12*d}
				elseIf(kaisu==3){6*d}
				else{d}
			</formula>
			sPrate*PayFactor(kaisu,gen,keiro)-Discount(d)
		</formula>

		<formula name="S2P" paras="SBasePrate" desc="S基準からP基準に変換する">
			<!-- 普通の場合 -->
			if(kaisu==1){
				round(1/SBasePrate,4)
			}else{
				round(1/SBasePrate,2)
			}
		</formula>

		<formula name="d" desc="高額割引率(d)">
			if(xtime&gt;0){
				0
			}else{
				if(gen==3||gen==4){
					if(SA&lt;20000000){0}
					elseIf(SA&gt;=20000000&amp;&amp;SA&lt;50000000){0.00002}
					else{0.00004}
				}elseIf(gen==2){
					if(SA&lt;15000000){0}
					elseIf(SA&gt;=15000000&amp;&amp;SA&lt;25000000){0.000005}
					elseIf(SA&gt;=25000000&amp;&amp;SA&lt;45000000){0.000015}
					else{0.00003}
				}elseIf(gen==1){
					if(SA&lt;25000000){0}
					else{0.00001}
				}else{0}
			}
		</formula>
	</Common>
	<Premium desc="保険料">
		<formula name="stdPrate" pvh="P" desc="基準Ｐレート">
			if(kaisu==1){singlePrate}else{MultiPrate}
			<formula name="singlePrate" fraction="5" desc="一時払いPレート">
				(A_x_n_D(x,n)+alpha(n)+gamma_nashu*a_x_n(x,n))/(1-delta(n))
			</formula>
			<formula name="MultiPrate" fraction="6" desc="分割払いPレート">
				if(m==n){
					if((x+n)&lt;90){
						set(t_Prate=MultiPrateCompare(n))
						set(i=n)
						while(i&lt;90-x){
							t_Prate=min(t_Prate,MultiPrateCompare(i))
							set(i=i+1)
						}
					}else{
						MultiPrateCompare(n)
					}+0.000000000001
				}elseIf(m&lt;n){
					MultiPrate2+0.000000000001
				}else{0}
				<formula name="MultiPrateCompare" paras="n">
					{A_x_n_D(x,n)+alpha(n)+gamma*a_k_x_n(12,x,n)}/warusu(n,n)
				</formula>
				<formula name="MultiPrate2">
					{A_x_n_D(x,n)+alpha(n)+gamma*a_k_x_n(12,x,m)+gamma_nashu*f_a_x_n(m,x,n)}/warusu(n,m)
				</formula>
				<formula name="warusu" paras="n,m">
					12*(1-beta-zeta-delta(n)-epsilon{m})*a_k_x_n(12,x,m)
				</formula>
			</formula>
		</formula>
		<formula name="Prate" pvh="P" accessable="true" desc="１．保険料レート">
			PrateByPaymode(stdPrate,d)
		</formula>
		<!-- OL用計算公式 -->
		<formula name="Premium" pvh="P" paras="stdPrate" accessable="true"
			desc="２．保険料・保険金">
			if(sptate==0){
				roundDown(SA*max{PrateByPaymode(stdPrate,d),0},0)
			}else{
				roundUp(
					roundDown(
						SA*S2P(PrateByPaymode(stdPrate,d))
					,0)/1000
				,0)*1000
			}
		</formula>
	</Premium>
	<ReserveFund desc="保険積立金">
	 <!-- ここから　保険年度末保険料積立金rate -->
		<formula name="BenifitPostponingV" paras="t,z" desc="保険料払込期間中/免除">
			max(A_xt_nt_D(x,t,n)+gamma_nashu*a_x_n(x+t,n-t)
	            -(A_x_n_D(x,n)+gamma_nashu*a_x_n(x,n))
	            / a_x_n(x,m)*a_x_n(x+t,m-t)-az_formula(t,z)
			,0)
	     </formula>
         <formula name="BenifitStartedV"  paras="t" desc="保険料払込期間終了後/一時払">
	        A_xt_nt_D(x,t,n)+gamma_nashu*a_x_n(x+t,n-t)
	     </formula>
	     	          
	     <!-- 保険年度末Vレート -->
	     <formula name="Vrate_accu" paras="t,z" desc="保険年度末rate">
			<!--保険料払込期間中/免除  -->
			if(state==1||state==6){
         	    BenifitPostponingV(t,z)
         	<!-- 保険料払込期間終了後/一時払 -->
			}elseIf(state==2||kaisu==1){
				BenifitStartedV(t)
			}else{0}
		</formula>
		<formula name="Vrate" paras="t" fraction="4" pvh="H" accessable="true" desc="１．保険年度末Vレート"> 
			Vrate_accu(t,0)
		</formula>
	     
	     <!-- 契約者用Vrate -->
	     <formula name="ContractorYearV" paras="t,z" pvh="P" fraction="4" desc="保険年度契約者VTレート">
	     	Vrate_accu(t,z)
	     </formula>
	     
	     <formula name="ContractorVrate" pvh="P" fraction="4" accessable="true" desc="３．契約者用Vレート">
	     	<!-- 保険料払込期間中/保険料払込免除契約-->
	        if(state==1||state==6){
	        	((1-f_12(f1)))*ContractorYearV(t1,z)+f_12(f1)*ContractorYearV(t1+1,z)  
	       	<!-- 保険料払込期間終了後/一時払 -->
	        }elseIf(state==2||kaisu==1){
	        	(1-f_12(f))*ContractorYearV(t,z)+f_12(f)*ContractorYearV(t+1,z)
	        }else{0}
	     </formula>
	     
	     <!-- ここから　事業年度末保険料積立金rate -->
	     <formula name="BizYearV" paras="t,z" accessable="false" desc="事業末Vレート">
	     <!-- 保険料払込期間中 -->
	        if(state==1){
	        	set{e1=round((A_x_n_D(x,n)+gamma_nashu*f_a_x_n(m,x,n))/a_x_n(x,m),6)}	
	        	if(e1&lt;Prate_ByPaymode){
	        		BenifitPostponingV(t,z)	
	          	}else{
	          		max(
	              		A_xt_nt_D(x,t,n)+gamma_nashu*a_x_n(x+t,n-t)-(Prate_ByPaymode+gamma_nashu)
	              		*a_x_n(x+t,m-t)-az_formula(t,z)
	              	,0)
	            }
	            <!--保険料払込期間終了後/一時払/保険料払込免除契約-->
	        }elseIf(state==2||state==6||kaisu==1){
	        	BenifitStartedV(t)
	        }else{0}	        
	       <!-- 年払Prate -->
	        <formula name="Prate_ByPaymode" pvh="P" fraction="6" desc="年払Prate">
	            stdPrate*PayFactor(2,gen,1)-12*d
	        </formula> 
		</formula>
		
		<formula name="calBizYearV" fraction="4" desc="事業末用Vレート">
			BizYearV(t,z)
		</formula>
	     
	 </ReserveFund>

	 <SurrenderFee desc="解約返戻金">
        <formula name="Wrate" pvh="P" fraction="4" accessable="true" desc="１．解約返戻金Wレート">
        	<!-- 保険料払込期間中/保険料払込免除契約-->
        	if(state==1||state==6){
        	<!-- 契約始期日：2010/04/01から -->
        		if(PremiumAbolishSign==1){
        		   if((12*t1+f1-12*t-f)&lt;0){
        		   	(1-f_12(f1))*WT_inpaid(t1)+f_12(f1)*WT_inpaid(t1+1)
        		   }else{
        		   	(1-f_12(f))*WT_inpaid(t)+f_12(f)*WT_inpaid(t+1)
        		   }
        		   <!-- 契約始期日：2008/02/02から2010/03/31まで -->
        		}elseIf(contractDate&gt;=20080202){
	                v^ve*round((1-f_12(f1))*WT_inpaid(t1)+f_12(f1)*WT_inpaid(t1+1),4)
	                <!-- 契約始期日：2008/02/01まで -->
        		}else{
					v^ve*round((1-f_12(f1))*min(WT_inpaid(t1),v_Vrate(t1))
					+f_12(f1)*min(WT_inpaid(t1+1),v_Vrate(t1+1)),4)
        	    }
        	   <!-- 保険料払込期間終了後/一時払 -->  
        	 }elseIf(state==2||kaisu==1){
        	    (1-f_12(f))*WT_inpaid_Started(t)+f_12(f)*WT_inpaid_Started(t+1)
        	}else{0}   
           <formula name="v_Vrate" pvh="V" paras="t" fraction="4">
           		BenifitPostponingV(t,min(m,5))
	       </formula>
	       <formula name="tsigma" paras="t" desc="解約控除率">
	          0.006*min(n/10,1)*max(1-t/min(m,10),0)
	       </formula> 
	       <formula name="WT_inpaid" paras="t" pvh="P" fraction="4" desc="払込中　または　免除">
	          max(ContractorYearV(t,0)-tsigma(t),0)
	       </formula> 
	       
	       <formula name="WT_inpaid_Started" paras="t" pvh="P" desc="保険料払込期間終了後 ">
	          max(ContractorYearV(t,0),0)
	       </formula>
	    </formula>
    </SurrenderFee>
</Formula-definition>