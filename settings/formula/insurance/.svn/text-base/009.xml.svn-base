<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE Formula-definition SYSTEM "Formula-definition.dtd">
<!-- 商品毎に計算公式はここに定義する -->
<Formula-definition>
	<BizExpenses desc="事業費率の設定">
		<formula name="alpha">
			if(gen==1){0.074}elseIf(gen==2){0.075}else{0.076}
		</formula>
		<formula name="delta">
			roundDown(0.02*min(max(m,10)/20,1),8)
		</formula>
		<formula name="gamma">
			if(gen==1){0.00832}elseIf(gen==2){0.00795}else{0.00809}
		</formula>
		<formula name="gamma1">
			if(gen==1){0.00688}elseIf(gen==2){0.00703}else{0.00704}
		</formula>
		<formula name="gamma_nashu">
			if(gen&lt;=2){0.00322}else{0.00323}
		</formula>
		<formula name="gamma2" value="0.00291"/>
		<formula name="gamma_2nashu" value="0.01"/>
		<formula name="gamma3" value="0.002"/>
		<formula name="beta" value="0.03"/>
		<formula name="zeta">
			if(gen==1){0.04}elseIf(gen==2){0.03}else{0.025}
		</formula>
		<formula name="epsilon" desc="払込免除">
			if(m&lt;=5){
				0.0005
			}elseIf(m&gt;5&amp;&amp;m&lt;=10){
				0.0010
			}else{
				0.0020
			}
		</formula>
		
		<formula name="q0" value="0.000328"/>
		
	</BizExpenses>
	
	<Common desc="商品内部の共通公式">
		<!-- 1125回答より -->
		<formula name="f_A_x_n_D" paras="f,x,n" fraction="6">
			A_x_n_l(x,n)*A_x_n_D(x+f,n-f)
		</formula>
		
		<formula name="tIx" paras="x,t" desc="祝金の給付割合">
			if(x+t==6){
				if(x&lt;=3){0.2}else{0}
			}elseIf(x+t==12){
				0.3
			}elseIf(x+t==15){
				0.5
			}elseIf(x+t==18){
				1.0
			}else{
				0
			}
		</formula>
		<formula name="tJx_jissai" paras="t" desc="祝金の給付割合の合計額（実際）">
			sum_tJx(x,t,birthday,contractDate,standardDate)
		</formula>
		<formula name="uHx" desc="養育年金の給付割合" value="0.5"/>
		<!-- 世代より最終年齢が違い -->
		<formula name="tFx" paras="t">
			sum(t,n-1){v^(index-t)*uHx}
		</formula>
		<formula name="tJx" paras="t" desc="契約日から（ｔ－１）経過年までに支払われるべき理論上給付割合の合計額">
			sum(0,t-1){tIx(x,index)}
		</formula>	
		<formula name="joinAfterBirth" desc="加入時点">
			if(birthday &gt; contractDate){1}else{0}
		</formula>
		
		<!-- 年金現価公式　ここから -->
		<formula name="f_a_xy_k_n" paras="f,k,n" fraction="5">
			if(contractorSex==1){
				sum(1,n){v^(f+index-1)*lx[x+f+index-1]*maleLy[y+f+index-1]}/(lx[x]*maleLy[y])
				-(k-1)/(2*k)*(v^f*lx[x+f]*maleLy[y+f]-v^(f+n)*lx[x+f+n]*maleLy[y+f+n])/(lx[x]*maleLy[y])
			}else{
				sum(1,n){v^(f+index-1)*lx[x+f+index-1]*femaleLy[y+f+index-1]}/(lx[x]*femaleLy[y])
				-(k-1)/(2*k)*(v^f*lx[x+f]*femaleLy[y+f]-v^(f+n)*lx[x+f+n]*femaleLy[y+f+n])/(lx[x]*femaleLy[y])
			}
		</formula>
		<formula name="a_xy_k_n" paras="k,n">
			f_a_xy_k_n(0,k,n)
		</formula>

		<formula name="f_A_xy_n@head" paras="f,n" fraction="6">
			if(contractorSex==1){
				1/(lx[x]*maleLy[y]) 
					*
				v^(f+1/2)*(lx[x+f]+lx[x+f+1])/2*maleDy[y+f]
			}else{
				1/(lx[x]*femaleLy[y]) 
					*
				v^(f+1/2)*(lx[x+f]+lx[x+f+1])/2*femaleDy[y+f]
			}
		</formula>
		<formula name="f_a_xy_n" paras="f,x,y,n" fraction="5">
			if(contractorSex==1){
			<!-- 契約者が男性の場合 -->
				sum(1,n){v^(f+index-1)*lx[x+f+index-1]*maleLy[y+f+index-1]}/(lx[x]*maleLy[y])
			}else{
			<!-- 契約者が女性の場合 -->
				sum(1,n){v^(f+index-1)*lx[x+f+index-1]*femaleLy[y+f+index-1]}/(lx[x]*femaleLy[y])
			}
		</formula>
		
		<formula name="a_xy_n" paras="x,y,n">f_a_xy_n(0,x,y,n)</formula>
		
		<formula name="f_A_x_y_n@head" paras="f,x,y,n" fraction="6">
			if(contractorSex==1){
				v^(f+1/2)*(lx[x+f]+lx[x+f+1])*maleDy[y+f]/(2*lx[x]*maleLy[y])
			}else{
				v^(f+1/2)*(lx[x+f]+lx[x+f+1])*femaleDy[y+f]/(2*lx[x]*femaleLy[y])
			}
		</formula>
		<formula name="f_a_x_y_n" paras="f,x,y,n">
			f_a_xy_n(f,x,y,n)
		</formula>
		<formula name="a_x_y_n" paras="x,y,n">
			a_xy_n(x,y,n)
		</formula>
		
		<formula name="a_g" paras="n" fraction="5">
			(1-v^n)/(1-v)
		</formula>
		
		<formula name="PrateByPaymode" paras="stdPrate,d" fraction="6" desc="払込方法別Prate">
			<!-- 基準Prateと高額割引dより、払込方法別Prateを求める -->
			<formula name="Discount" paras="d" desc="高額割引">
				if(kaisu==1){0}
				elseIf(kaisu==2){12*d}
				elseIf(kaisu==3){6*d}
				else{d}
			</formula>
			stdPrate*PayFactor(kaisu,gen,keiro)-Discount(d)
		</formula>
		
		<formula name="S2P" paras="SBasePrate" desc="S基準からP基準に変換する">
			<!-- 普通の場合 -->
			if(kaisu==1){
				round(1/SBasePrate,4)
			}else{
				round(1/SBasePrate,2)
			}
		</formula>
		
	</Common>
	
	<!-- 保険料　ここから -->
	<Premium desc="保険料">
		<formula name="stdPrate" pvh="P" fraction="6" accessable="false" desc="基準保険料レート">
			1/{12*(1-beta-zeta-delta-epsilon)*a_xy_k_n(12,m)}
				*
			{
				(1+gamma_2nashu)*sum(0,n-1){tFx(index)*f_A_xy_n@head(index,1)}
					+
				sum(0,m){tIx(x,index)*A_x_n_l(x,index)}+2*v^(1/2)*q0*(a_x_n(x,m)-1/(m+1)*Ia_x_m(x,m))
					+
				2/(m+1)*IA_x_n_D(x,m)+
				2*A_x_n_l(x,m)*A_xt_nt_D(x,m,n)
				+alpha+gamma*a_xy_k_n(12,m)
				+gamma_nashu*f_a_xy_n(m,x,y,n-m)
			}
		</formula>
		<formula name="Prate" pvh="P" accessable="true" desc="１．保険料レート">
			PrateByPaymode(stdPrate,0)
		</formula>
		
		<formula name="Premium" pvh="P" accessable="true" desc="２．保険料・保険金">
			<!-- 高額割引がゼロ １００円の位を切り上げ-->
			if(sptate==0){
				roundDown(SA*Prate,0)
			}else{
				roundUp(
						roundDown(
							SA*S2P(Prate)
							,0)/1000
					,0)*1000
			}
		</formula>
	</Premium>
	
	<!-- 責任準備金　ここから -->
	<ReserveFund desc="責任準備金">
		<!-- 年金支払開始前 -->
		<formula name="BeforeBenifitV" paras="t,z" desc="養育年金支払事由発生前VTレート">
			if(state==1||state==6){
				max{
					sum(t,n-1){(1+gamma_2nashu)*tFx(index)*f_A_x_y_n@head(index-t,x+t,y+t,1)}
					+sum(t,m){tIx(x,index)*A_x_n_l(x+t,index-t)}
					+2*v^(1/2)*q0*{a_x_n(x+t,m-t)-1/(m+1)*{Ia_x_m(x+t,m-t)+t*a_x_n(x+t,m-t)}}
					+2/(m+1)*(IA_x_n_D(x+t,m-t)+t*A_x_n_D(x+t,m-t))+2*A_x_n_l(x+t,m-t)*A_xt_nt_D(x,m,n)
					+gamma_nashu*a_x_y_n(x+t,y+t,n-t)
					-(k+gamma_nashu*f_a_xy_n(0,x,y,n))/a_xy_n(x,y,m)*a_x_y_n(x+t,y+t,m-t)+tJx(t)-tJx_jissai(t)
					-if(z==0){0}else{alpha/a_xy_n(x,y,z)*a_x_y_n(x+t,y+t,z-t)}
				,0}
			}elseIf(state==2){
				sum(t,n-1){(1+gamma_2nashu)*tFx(index)*f_A_x_y_n@head(index-t,x+t,y+t,1)}
				+2*A_x_n_D(x+t,n-t)+gamma_nashu*a_x_y_n(x+t,y+t,n-t)
			}else{0}
			<formula name="k">
				sum(0,n-1){(1+gamma_2nashu)*tFx(index)*f_A_x_y_n@head(index,x,y,1)}
				+sum(0,m){tIx(x,index)*A_x_n_l(x,index)}+2*v^(1/2)*q0*{a_x_n(x,m)-1/(m+1)*Ia_x_m(x,m)}
				+2/(m+1)*IA_x_n_D(x,m)+2*A_x_n_l(x,m)*A_xt_nt_D(x,m,n)
			</formula>
		</formula>
		<formula name="AfterBenifitV" paras="t,z" desc="養育年金支払事由発生後VTレート">
			if(state==6){
				max{
					sum(t,m){tIx(x,index)*A_x_n_l(x+t,index-t)}+2*v^(1/2)*q0*
					{a_x_n(x+t,m-t)-1/(m+1)*{Ia_x_m(x+t,m-t)+t*a_x_n(x+t,m-t)}}
					+2/(m+1)*{IA_x_n_D(x+t,m-t)+t*A_x_n_D(x+t,m-t)}+2*A_x_n_l(x+t,m-t)*A_xt_nt_D(x,m,n)
					+gamma2*a_x_y_n(x+t,y+t,n-t)-(k_nashu+gamma2*a_xy_n(x,y,n))/a_xy_n(x,y,m)*a_x_y_n(x+t,y+t,m-t)
					+tJx(t)-tJx_jissai(t)
					-if(z==0){0}else{alpha/a_xy_n(x,y,z)*a_x_y_n(x+t,y+t,z-t)}
					,0
				}
			}elseIf(state==2){
				2*A_x_n_D(x+t,n-t)+gamma2*a_x_n(x+t,n-t)
			}else{0}
			<formula name="k_nashu">
				sum(0,m){tIx(x,index)*A_x_n_l(x,index)}+2*v^(1/2)*q0*{a_x_n(x,m)-1/(m+1)*Ia_x_m(x,m)}
				+2/(m+1)*IA_x_n_D(x,m)+2*A_x_n_l(x,m)*A_xt_nt_D(x,m,n)
			</formula>
		</formula>
		<formula name="BenifitPartV" paras="t" fraction="4" desc="養育年金部分">
			a_g(n-t)*(1+gamma_2nashu)
		</formula>
		<formula name="PaidupV" paras="t" fraction="4" desc="払済保険VTレート">
			A_x_n(x+t,n-t)+gamma3*a_x_n(x+t,n-t)
		</formula>
		
		<formula name="Vrate_accu" paras="t,z" desc="保険年度末rate">
			if(state==4){
				PaidupV(t)
			}else{
				if(afterBenifitPay==0){
					<!-- 事由発生前 -->
					BeforeBenifitV(t,z)
				}else{
					AfterBenifitV(t,z)
				}
			}
		</formula>
		<formula name="Vrate" pvh="H" fraction="4" accessable="true" desc="１．保険年度末Vレート">
			Vrate_accu(t,0)
		</formula>
		<!-- 契約者保険年度Vrate　ここから -->
		<formula name="ContractorYearV" fraction="4" paras="t,z" pvh="P" desc="契約者保険年度Vrate">
			Vrate_accu(t,z)
		</formula>

		<formula name="ContractorVrate" pvh="P" fraction="4" accessable="true" desc="３．契約者用Vレート">
			if(state==1 || state==6){
				<!-- 払込期間中または　免除 -->
				(1-f_12(f1))*{ContractorYearV(t1,z)+tJx_jissai(t1)}
					+
				f_12(f1)*{ContractorYearV(t1+1,z)+tJx_jissai(t1+1)}
					-
				sJx(x,birthday,standardDate,contractDate)
			}elseIf(state==2 || state== 4){
				<!-- 払込終了後または　払済 -->
				(1-f_12(f))*ContractorYearV(t,z)+f_12(f)*ContractorYearV(t+1,z)
			}else{0}
		</formula>

		<formula name="BeforeBenifitBizV" paras="t,z" desc="事業年度末養育年金支払事由発生前VTレート">
			if(state==1){
				if(round((k+gamma_nashu*f_a_xy_n(0,x,y,n))/a_xy_n(x,y,m),6)&lt;=round(stdPrate*PayFactor(2,gen,1),6)){
					BeforeBenifitV
				}else{
					max{
					sum(t,n-1){(1+gamma_2nashu)*tFx(index)*f_A_x_y_n@head(index-t,x+t,y+t,1)}
					+sum(t,m){tIx(x,index)*A_x_n_l(x+t,index-t)}
					+2*v^(1/2)*q0*{a_x_n(x+t,m-t)-1/(m+1)*{Ia_x_m(x+t,m-t)+t*a_x_n(x+t,m-t)}}
					+2/(m+1)*(IA_x_n_D(x+t,m-t)+t*A_x_n_l(x+t,m-t))+2*A_x_n_l(x+t,m-t)*A_xt_nt_D(x,m,n)
					+gamma_nashu*a_x_y_n(x+t,y+t,n-t)
					-stdPrate*PayFactor(2,gen,1)+gamma_nashu
					*a_x_y_n(x+t,y+t,m-t)+tJx(t)-tJx_jissai(t)
					-if(z==0){0}else{alpha/a_xy_n(x,y,z)*a_x_y_n(x+t,y+t,z-t)}
					,0}
				}
			}elseIf(state==6){
				sum(t,n-1){(1+gamma_2nashu)*tFx(index)*f_A_x_y_n@head(index-t,x+t,y+t,1)}
				+sum(t,m){tIx(x,index)*A_x_n_l(x+t,index-t)}+2*v^(1/2)*q0*{a_x_n(x+t,m-t)-1/(m+1)*{Ia_x_m(x+t,m-t)+t*a_x_n(x+t,m-t)}}
				+2/(m+1)*(IA_x_n_D(x+t,m-t)+t*A_x_n_l(x+t,m-t))+2*A_x_n_l(x+t,m-t)*A_xt_nt_D(x,m,n)
				+gamma1*a_x_y_n(x+t,y+t,n-t)+tJx(t)-tJx_jissai(t)
			}elseIf(state==2){
				sum(t,n-1){(1+gamma_2nashu)*tFx(index)*f_A_x_y_n@head(index-t,x+t,y+t,1)}
				+2*A_x_n_D(x+t,n-t)+gamma_nashu*a_x_y_n(x+t,y+t,n-t)
			}else{0}
		</formula>
		<formula name="k">
			<!-- 1118取込 -->
			sum(0,n-1){(1+gamma_2nashu)*tFx(index)*f_A_x_y_n@head(index,x,y,1)}
			+sum(0,m){tIx(x,index)*A_x_n_l(x,index)}+2*v^(1/2)*q0*{a_x_n(x,m)-1/(m+1)*Ia_x_m(x,m)}
			+2/(m+1)*IA_x_n_D(x,m)+2*A_x_n_l(x,m)*A_xt_nt_D(x,m,n)
		</formula>
				
		<formula name="AfterBenifitBizV" paras="t,z" desc="事業年度末養育年金支払事由発生後VTレート">
			if(state==6){
				sum(t,m){tIx(x,index)*A_x_n_l(x+t,index-t)}+2*v^(1/2)*q0*
				{a_x_n(x+t,m-t)-1/(m+1)*{Ia_x_m(x+t,m-t)+t*a_x_n(x+t,m-t)}}
				+2/(m+1)*{IA_x_n_D(x+t,m-t)+t*A_x_n_D(x+t,m-t)}+2*A_x_n_l(x+t,m-t)*A_xt_nt_D(x,m,n)
				+gamma2*a_x_y_n(x+t,y+t,n-t)+tJx(t)-tJx_jissai(t)
				-if(z==0){0}else{alpha/a_xy_n(x,y,z)*a_x_y_n(x+t,y+t,z-t)}
			}elseIf(state==2){
				2*A_x_n_D(x+t,n-t)+gamma2*a_x_n(x+t,n-t)
			}else{0}
		</formula>
			
		<formula name="BizYearV" paras="t,z" accessable="false" desc="事業末Vレート">
			if(state==4){
				PaidupV(t)
			}else{
				if(afterBenifitPay==0){
					<!-- 事由発生前 -->
					BeforeBenifitBizV(t,z)
				}else{
					AfterBenifitBizV(t,z)
				}
			}
		</formula>
	
		<formula name="calBizYearV" fraction="4" desc="事業末用Vレート">
			BizYearV(t,z)
		</formula>
			
		<formula name="BenifitPartVate" pvh="if(kisoritsu==0){P}elseIf(kisoritsu==1){V}else{H}" fraction="4" accessable="true" desc="７．養育年金">
			(1-f_12(f))*BenifitPartV(t)+f_12(f)*BenifitPartV(t+1)
		</formula>
		
	</ReserveFund>
	
	<!-- 解約返戻金　ここから -->
	<SurrenderFee desc="解約返戻金">
		<formula name="tWrate" paras="t" fraction="4" pvh="P">
			<formula name="tSigma" paras="t">
				0.056*max{1-t/min(m,10),0}
			</formula>
			if(state==1 || state==6){
				<!-- 払込期間中　または　免除 -->
				max{ContractorYearV(t,0)+tJx_jissai(t)-tSigma(t),0}
			}elseIf(state==2 || state==4){
				<!-- 払込期間終了後　または払済 -->
				max{ContractorYearV(t,0),0}
			}else{0}
		</formula>

		<formula name="Wrate" fraction="4" pvh="P" accessable="true" desc="１．解約返戻金Wレート">
			<formula name="Vrate_nashu" pvh="V" paras="t" fraction="4">
				if(afterBenifitPay==0){
					<!-- 事由発生前 -->
					BeforeBenifitV(t,min(m,5))
				}else{
					AfterBenifitV(t,min(m,5))
				}
			</formula>
			if(state==1 || state==6){
				if(PremiumAbolishSign==1){
					max(
					if((12*t1+f1-12*t-f)&lt;0){
						round((1-f_12(f1))*tWrate(t1)+f_12(f1)*tWrate(t1+1),4)-sJx(x,birthday,standardDate,contractDate)
					}else{
						round((1-f_12(f))*tWrate(t)+f_12(f)*tWrate(t+1),4)-sJx(x,birthday,standardDate,contractDate)
					},0)
				}elseIf(contractDate&gt;=20080202){
					v^ve*max(round(round((1-f_12(f1))*tWrate(t1)+f_12(f1)*tWrate(t1+1),4)-sJx(x,birthday,standardDate,contractDate),4),0)
				}else{
					v^ve*max(round(round(
						(1-f_12(f1))*min{tWrate(t1),Vrate_nashu(t1)+tJx_jissai(t1)}
							+
						f_12(f1)*min{tWrate(t1+1),Vrate_nashu(t1+1)+tJx_jissai(t1+1)},4)
							-
						sJx(x,birthday,standardDate,contractDate)
						,4),0)
				}		
			}elseIf(state==2 || state==4){
				(1-f_12(f))*tWrate(t)+f_12(f)*tWrate(t+1)
			}else{0}
		</formula>
	</SurrenderFee>
</Formula-definition>