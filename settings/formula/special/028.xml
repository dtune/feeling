<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE Formula-definition SYSTEM "Formula-definition.dtd">
<!-- 商品毎に計算公式はここに定義する -->
<Formula-definition>
	<!-- 保険料　ここから -->
	<Premium desc="保険料">
		<formula name="x4Prate" xtime="4" desc="4倍体基準Prate">
			stdPrate
		</formula>
		<formula name="x1Prate" xtime="1" desc="1倍体基準Prate">
			stdPrate
		</formula>
		<formula name="Special_stdPrate" fraction="4" desc="特別条件付基準Prate">
			(specialLambda-1)*(x4Prate-x1Prate)/(specialLambda1-1)+0.000000000001
		</formula>
		<formula name="Special_Prate" pvh="P" desc="特別条件付Prate">
			PrateByPaymode(Special_stdPrate,0)
		</formula>
		<formula name="Special_Premium" pvh="P" accessable="true" desc="特別条件付保険料/保険金額">
			<!--Ｓ建てとして計算する -->
			roundDown(SA*max(PrateByPaymode(Special_stdPrate,0),0),0)
		</formula>
		
		<!--統計側依赖「統計側からの対応作業依頼.xls」-->
		<formula name="x4sts_stdPL" xtime="4" desc="統計側特体生存Pレート">
			sts_stdPL
		</formula>
		<formula name="x4sts_stdPD" xtime="4" desc="統計側特体死亡Pレート">
			sts_stdPD
		</formula>
		<formula name="x1sts_stdPL" xtime="1" desc="統計側標体生存Pレート">
			sts_stdPL
		</formula>
		<formula name="x1sts_stdPD" xtime="1" desc="統計側標体死亡Pレート">
			sts_stdPD
		</formula>
		<formula name="sts_stdPLSpecial" fraction="4" desc="統計側生存特体Prate">
			(specialLambda-1)/(specialLambda1-1)*(x4sts_stdPL-x1sts_stdPL)
		</formula>
		<formula name="sts_stdPDSpecial" fraction="4" desc="統計側死亡特体Prate">
			(specialLambda-1)/(specialLambda1-1)*(x4sts_stdPD-x1sts_stdPD)
		</formula>		
		<formula name="stsPLSpecial" pvh="P" desc="統計側生存特別条件付保険料">
			roundDown(SA*PrateByPaymode(sts_stdPLSpecial,0),0)
		</formula>
		<formula name="stsPDSpecial" pvh="P" desc="統計側死亡特別条件付保険料">
			roundDown(SA*PrateByPaymode(sts_stdPDSpecial,0),0)
		</formula>
	</Premium>

	<!-- 責任準備金　ここから -->
	<ReserveFund desc="責任準備金">
		<formula name="normalPrate" pvh="P" xtime="0" fraction="4" desc="標準体Prate">
			PayFactor(2,gen,1)*stdPrate-12*d
		</formula>

		<formula name="x4ContractorVrate" xtime="4" desc="4倍体契約者用レート">
			ContractorVrate
		</formula>
		<formula name="x1ContractorVrate" xtime="1" desc="1倍体契約者用レート">
			ContractorVrate
		</formula>
		<formula name="Special_ContractorVrate" pvh="P" accessable="true" fraction="3" desc="特体契約者レート">
			(specialLambda-1)*(x4ContractorVrate-x1ContractorVrate)/(specialLambda1-1)
		</formula>
		<formula name="Special_Valuation" fraction="0" pvh="P" accessable="true" desc="特体契約者実額">
		 	max(SA*Special_ContractorVrate,0)
		</formula>
		<formula name="x4BizYear" xtime="4" fraction="3" accessable="false" desc="4倍体事業年度末用Vレート">
			<formula name="special_yearPrate" fraction="4" pvh="P" desc="比較用の特体年払Prate">
				round((x4Prate-x1Prate)*PayFactor(2,gen,1),4)+normalPrate
			</formula>
			set{z=0}
			if(state==1){
            <!-- 払込中-->
            	set{e1=((1+gamma2)*A_xt_nt(x,n,0)+I*A_xt_nt_l(x,n,0)+(gammaD_nashu+gammaL_nashu)*f_a_x_n(m,x,n))/a_x_n(x,m)}	
            	if(round(e1,4)&lt;=special_yearPrate){
				max{
					(1+gamma2)*A_xt_nt(x,n,t)+I*A_xt_nt_l(x,n,t)+(gammaD_nashu+gammaL_nashu)*ft_a_xt_n(m,t,x,n)
						-
					((1+gamma2)*A_xt_nt(x,n,0)+I*A_xt_nt_l(x,n,0)+(gammaD_nashu+gammaL_nashu)*f_a_x_n(m,x,n))/a_x_n(x,m)*a_x_n(x+t,m-t)
						-
					if(z==0){0}else{A_Z*a_x_n(x+t,z-t)/a_x_n(x,z)}
				,0}
            	}else{
            		max{
					(1+gamma2)*A_xt_nt(x,n,t)+I*A_xt_nt_l(x,n,t)+(gammaD_nashu+gammaL_nashu)*ft_a_xt_n(m,t,x,n)
						-
					special_yearPrate*a_x_n(x+t,m-t)
						-
					if(z==0){0}else{A_Z*a_x_n(x+t,z-t)/a_x_n(x,z)}
				    ,0}
            	}
			}elseIf(state==2||state==6){
			<!-- 保険料払込期間終了後.払込免除 -->
				(1+gamma2)*A_xt_nt(x,n,t)+I*A_xt_nt_l(x,n,t)+(gammaD_nashu+gammaL_nashu)*a_x_n(x+t,n-t)
			}elseIf(state==3){
			<!-- 年金支払開始以後 -->
				BenifitStartedV
			}elseIf(kaisu==1){
			<!-- 一時払 -->
				(1+gamma2)*A_xt_nt(x,n,t)+I*A_xt_nt_l(x,n,t)+(gamma1L+gamma1D)*a_x_n(x+t,n-t)
			}else{0}
		</formula>
		<formula name="x1BizYear" xtime="1" fraction="3" accessable="false" desc="1倍体事業年度末用Vレート">
			BizYearV(t,0)
		</formula>
		<formula name="Special_BizYearVate" pvh="if(kisoritsu==0){P}elseIf(kisoritsu==1){V}else{H}" fraction="3" accessable="true" desc="特体事業年度末レート">
			(specialLambda-1)*(x4BizYear-x1BizYear)/(specialLambda1-1)
		</formula>
		<formula name="Special_BizYearValuation" fraction="0" pvh="if(kisoritsu==0){P}elseIf(kisoritsu==1){V}else{H}" accessable="true" desc="特体業年度末実額">
			SA*Special_BizYearVate
		</formula>
	</ReserveFund>
</Formula-definition>